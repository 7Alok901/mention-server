<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SBR MENTION TOOL</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 CDN -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

<div class="container my-4">
<h2 class="text-center mb-4" style="color: #ff6600;">𑁔𑁔★ 𝕊𝔹ℝ ℝ𝕌𝕃𝔼𝕏 ℍ𝔼ℝ𝔼 ★𑁔𑁔</h2>


  <h5>SBR MENTION TOOL</h5>

  <!-- Upload Section -->
  <div class="card mb-3">
    <div class="card-body">
      <h5>1. Upload Files</h5>
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="mb-2">
          <label for="tokens" class="form-label">Tokens File</label>
          <input type="file" class="form-control" id="tokens" name="tokens" required>
        </div>
        <div class="mb-3">
          <label for="comments" class="form-label">Comments File</label>
          <input type="file" class="form-control" id="comments" name="comments" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Upload</button>
      </form>
    </div>
  </div>

  <!-- Automation Config -->
  <div class="card mb-3">
    <div class="card-body">
      <h5>2. Configure Loader</h5>
      <form id="automationForm">
        <div class="mb-2">
          <label for="post_ids" class="form-label">Post IDs (comma separated)</label>
          <input type="text" class="form-control" id="post_ids" required>
        </div>
        <div class="mb-2">
          <label for="delay" class="form-label">Minimum Delay (seconds)</label>
          <input type="number" class="form-control" id="delay" value="60" min="60" required>
        </div>
        <div class="mb-2">
          <label for="mention_id" class="form-label">Mention ID (optional)</label>
          <input type="text" class="form-control" id="mention_id">
        </div>
        <div class="mb-3">
          <label for="mention_name" class="form-label">Mention Name (optional)</label>
          <input type="text" class="form-control" id="mention_name">
        </div>
        <button type="submit" class="btn btn-success w-100">Start Loader</button>
      </form>
    </div>
  </div>

  <!-- Stop Task -->
  <div class="card mb-3">
    <div class="card-body">
      <h5>3. Stop Loader</h5>
      <form id="stopForm">
        <label for="task_id" class="form-label">Task ID</label>
        <input type="text" class="form-control mb-2" id="task_id" placeholder="Enter Task ID to stop" required>
        <button type="submit" class="btn btn-danger w-100">Stop Loader</button>
      </form>
    </div>
  </div>

  <!-- Status / Logs -->
  <div class="card mb-4">
    <div class="card-body">
      <h5>4. Status & Logs</h5>
      <button class="btn btn-outline-primary w-100 mb-2" id="refreshStatus">Refresh Status</button>
      <pre id="statusBox" class="bg-dark text-white p-2 rounded" style="height: 200px; overflow-y: scroll;"></pre>
      <a href="/download_logs" class="btn btn-outline-secondary w-100">Download Logs</a>
    </div>
  </div>
</div>

<!-- Bootstrap JS + Axios -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

<script>
  let uploadedData = {};

  // Upload files
  document.getElementById('uploadForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const formData = new FormData(this);
    try {
      const response = await axios.post('/upload', formData);
      if (response.data.success) {
        uploadedData = response.data.files;
        alert('Files uploaded successfully!');
      } else {
        alert('Upload failed: ' + response.data.error);
      }
    } catch (error) {
      alert('Upload error: ' + error.message);
    }
  });

  // Start automation
  document.getElementById('automationForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    if (!uploadedData.tokens || !uploadedData.comments) {
      return alert('Please upload both tokens and comments files first.');
    }

    const payload = {
      tokens: uploadedData.tokens,
      comments: uploadedData.comments,
      post_ids: document.getElementById('post_ids').value,
      delay: parseInt(document.getElementById('delay').value),
      mention_id: document.getElementById('mention_id').value,
      mention_name: document.getElementById('mention_name').value
    };

    try {
      const response = await axios.post('/start_automation', payload);
      if (response.data.success) {
        document.getElementById('task_id').value = response.data.task_id;
        alert(`Automation started. Task ID: ${response.data.task_id}`);
      } else {
        alert('Failed to start: ' + response.data.error);
      }
    } catch (error) {
      alert('Start error: ' + error.message);
    }
  });

  // Stop automation
  document.getElementById('stopForm').addEventListener('submit', async function (e) {
    e.preventDefault();
    const task_id = document.getElementById('task_id').value;
    if (!task_id) return alert('Task ID required.');

    try {
      const response = await axios.post('/stop_automation', { task_id });
      alert(response.data.message);
    } catch (error) {
      alert('Stop error: ' + error.message);
    }
  });

  // Refresh status
  document.getElementById('refreshStatus').addEventListener('click', async () => {
    try {
      const res = await axios.get('/status');
      document.getElementById('statusBox').textContent = JSON.stringify(res.data, null, 2);
    } catch (err) {
      document.getElementById('statusBox').textContent = 'Error fetching status.';
    }
  });
</script>
</body>
</html>
